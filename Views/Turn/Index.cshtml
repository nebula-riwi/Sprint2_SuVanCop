@{
    ViewData["Title"] = "Turnero Digital";
    //Layout = "_Layout";  Opcional, puedes usar el layout normal o dejarlo sin layout si es una pantalla Kiosko.
}

<div class="text-center">
    <h1 class="display-4 text-primary">Sistema de Turnos</h1>
    <p class="lead">Pulse el botón para obtener su turno.</p>
</div>

@* Muestra mensaje de error si la generación/impresión falló *@
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger" role="alert">
        @TempData["ErrorMessage"]
    </div>
}

<div class="row mt-5 justify-content-center">
    
    <div class="col-md-4 mb-4">
        <form asp-controller="Turn" asp-action="CreateTurn" method="post">
            <input type="hidden" name="type" value="G" /> 
            <button type="submit" class="btn btn-primary btn-lg w-100 turn-button">
                Atención General (G)
                <br><span class="turn-label">TOMAR TURNO</span>
            </button>
        </form>
    </div>

    <div class="col-md-4 mb-4">
        <form asp-controller="Turn" asp-action="CreateTurn" method="post">
            <input type="hidden" name="type" value="R" />
            <button type="submit" class="btn btn-info btn-lg w-100 turn-button">
                Registros (R)
                <br><span class="turn-label">TOMAR TURNO</span>
            </button>
        </form>
    </div>

    <div class="col-md-4 mb-4">
        <form asp-controller="Turn" asp-action="CreateTurn" method="post">
            <input type="hidden" name="type" value="C" />
            <button type="submit" class="btn btn-success btn-lg w-100 turn-button">
                PQR's (C)
                <br><span class="turn-label">TOMAR TURNO</span>
            </button>
        </form>
    </div>

</div>

<style>
    .turn-button {
        height: 200px; 
        font-size: 2.5em; 
        font-weight: bold;
        transition: transform 0.2s;
    }
    .turn-label {
        font-size: 0.4em;
        font-weight: normal;
        display: block;
        margin-top: 5px;
    }
</style>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
@* Bloque de scripts para mostrar la notificación *@
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Recuperar el código y el mensaje de éxito pasado por TempData
        const successMessage = '@TempData["SuccessMessage"]';
        const turnCode = '@TempData["TurnCode"]';

        // Si existe un mensaje de éxito, mostramos la alerta
        if (successMessage && successMessage !== '') {
            Swal.fire({
                title: '¡Turno Generado!',
                html: `
                    ${successMessage}<br><br>
                    <strong>Su código es: <span style="font-size: 2.5em; color: #dc3545;">${turnCode}</span></strong>
                    <br>El ticket ha sido enviado a la impresora.
                `,
                icon: 'success',
                confirmButtonText: 'Entendido',
                customClass: {
                    container: 'my-swal-popup'
                }
            });
        }
    });
</script>